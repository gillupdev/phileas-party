import{Aa as C,Ca as n,Da as r,Ea as S,Fa as E,Ga as f,Ha as v,Ia as s,J as h,Ja as a,Ka as u,La as x,Na as w,O as _,P as g,Xa as I,_ as p,_a as G,ia as A,ja as o,ra as y,xa as m,ya as c,za as b}from"./chunk-JP74YVSF.js";var k=(t,i)=>i.id;function V(t,i){if(t&1&&S(0,"img",9),t&2){let e=s();f("src",e.picture,A)}}function P(t,i){if(t&1){let e=E();n(0,"div",8),m(1,V,1,1,"img",9),n(2,"span",10),a(3),r()(),n(4,"button",11),v("click",function(){_(e);let l=s();return g(l.logout())}),a(5,"Deconnexion"),r()}if(t&2){let e=i;o(),c(e.picture?1:-1),o(2),u(e.name)}}function D(t,i){if(t&1&&(n(0,"div",6),a(1),r()),t&2){let e=s();o(),x(" ",e.error()," ")}}function F(t,i){if(t&1){let e=E();n(0,"div",12)(1,"label"),a(2,"Tu reponds en tant que"),r(),n(3,"div",13),a(4),r()(),n(5,"div",14)(6,"button",15),v("click",function(){_(e);let l=s();return g(l.submitRSVP(!0))}),a(7),r(),n(8,"button",16),v("click",function(){_(e);let l=s();return g(l.submitRSVP(!1))}),a(9),r()()}if(t&2){let e=s();o(4),u(e.userName()),o(2),f("disabled",e.loading()),o(),x(" ",e.loading()?"...":"Je viens !"," "),o(),f("disabled",e.loading()),o(),x(" ",e.loading()?"...":"Pas dispo"," ")}}function N(t,i){if(t&1){let e=E();n(0,"div",7)(1,"p"),a(2),r(),n(3,"button",17),v("click",function(){_(e);let l=s();return g(l.resetForm())}),a(4," Modifier ma reponse "),r()()}if(t&2){let e=s();o(2),x("Merci ",e.userName()," !")}}function M(t,i){if(t&1&&(n(0,"li"),a(1),r()),t&2){let e=i.$implicit;o(),u(e.name)}}function O(t,i){if(t&1&&(n(0,"div",20)(1,"h3"),a(2,"Presents "),n(3,"span"),a(4),r()(),n(5,"ul",22),b(6,M,2,1,"li",null,k),r()()),t&2){let e=s(2);o(4),u(e.attendingGuests.length),o(2),C(e.attendingGuests)}}function U(t,i){if(t&1&&(n(0,"li"),a(1),r()),t&2){let e=i.$implicit;o(),u(e.name)}}function L(t,i){if(t&1&&(n(0,"div",21)(1,"h3"),a(2,"Absents "),n(3,"span"),a(4),r()(),n(5,"ul",22),b(6,U,2,1,"li",null,k),r()()),t&2){let e=s(2);o(4),u(e.notAttendingGuests.length),o(2),C(e.notAttendingGuests)}}function R(t,i){if(t&1&&(S(0,"div",18),n(1,"div",19),m(2,O,8,1,"div",20),m(3,L,8,1,"div",21),r()),t&2){let e=s();o(2),c(e.attendingGuests.length>0?2:-1),o(),c(e.notAttendingGuests.length>0?3:-1)}}var T=class t{http=h(I);authService=h(G);apiUrl="/api/guests";pollInterval;guests=p([]);showForm=p(!0);submitted=p(!1);loading=p(!1);error=p("");user=this.authService.user;userName=w(()=>this.user()?.name||"");ngOnInit(){this.loadGuests(),this.pollInterval=setInterval(()=>this.loadGuests(),5e3)}ngOnDestroy(){this.pollInterval&&clearInterval(this.pollInterval)}loadGuests(){this.http.get(this.apiUrl,{withCredentials:!0}).subscribe({next:i=>{this.guests.set(i),this.error.set("")},error:i=>{i.status===401?this.error.set("Session expired. Please refresh the page."):this.error.set("Could not connect to server. Make sure the server is running!"),console.error("Failed to load guests:",i)}})}submitRSVP(i){let e=this.userName();e&&(this.loading.set(!0),this.http.post(this.apiUrl,{name:e,attending:i},{withCredentials:!0}).subscribe({next:()=>{this.loadGuests(),this.submitted.set(!0),this.showForm.set(!1),this.loading.set(!1)},error:d=>{this.error.set("Failed to submit. Please try again!"),this.loading.set(!1),console.error("Failed to submit RSVP:",d)}}))}resetForm(){this.submitted.set(!1),this.showForm.set(!0)}logout(){this.authService.logout().subscribe(()=>{window.location.href="/login"})}get attendingGuests(){return this.guests().filter(i=>i.attending===1)}get notAttendingGuests(){return this.guests().filter(i=>i.attending===0)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-rsvp"]],decls:16,vars:4,consts:[[1,"page"],[1,"container"],[1,"card"],[1,"user-bar"],[1,"header"],[1,"badge"],[1,"error-message"],[1,"confirmation"],[1,"user-info"],["alt","Photo de profil","referrerpolicy","no-referrer",1,"user-avatar",3,"src"],[1,"user-name"],[1,"btn-logout",3,"click"],[1,"form-group"],[1,"user-display"],[1,"btn-group"],[1,"btn","btn-primary",3,"click","disabled"],[1,"btn","btn-secondary",3,"click","disabled"],[1,"btn-link",3,"click"],[1,"divider"],[1,"guests"],[1,"guest-col"],[1,"guest-col","absent"],[1,"guest-list"]],template:function(e,d){if(e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),m(4,P,6,2),r(),n(5,"div",4)(6,"span",5),a(7,"23 Mars 2025"),r(),n(8,"h1"),a(9,"Phileas"),r(),n(10,"p"),a(11,"fete ses 8 ans !"),r()(),m(12,D,2,1,"div",6),m(13,F,10,5)(14,N,5,1,"div",7),m(15,R,4,2),r()()()),e&2){let l;o(4),c((l=d.user())?4:-1,l),o(8),c(d.error()?12:-1),o(),c(d.showForm()?13:14),o(2),c(d.attendingGuests.length>0||d.notAttendingGuests.length>0?15:-1)}},encapsulation:2})};export{T as App};
