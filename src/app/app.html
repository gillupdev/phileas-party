<div class="page">
  <div class="container">
    <div class="card">
      <div class="top-bar">
        <button class="btn-lang" (click)="toggleLanguage()">
          {{ lang() === 'fr' ? 'EN' : 'FR' }}
        </button>
        @if (user(); as currentUser) {
          <div class="user-info">
            @if (currentUser.picture) {
              <img [src]="currentUser.picture" [alt]="t().profileAlt" class="user-avatar" referrerpolicy="no-referrer" />
            }
            <span class="user-name">{{ currentUser.name }}</span>
          </div>
          <button class="btn-logout" (click)="logout()">{{ t().logout }}</button>
        }
      </div>

      <div class="header">
        <span class="badge">{{ t().date }}</span>
        <h1>{{ t().title }}</h1>
        <p>{{ t().subtitle }}</p>
      </div>

      @if (error()) {
        <div class="error-message">
          {{ error() }}
        </div>
      }

      @if (showForm()) {
        <div class="form-group">
          <label>{{ t().respondAs }}</label>
          <div class="user-display">{{ userName() }}</div>
        </div>
        <div class="btn-group">
          <button
            class="btn btn-primary"
            (click)="submitRSVP(true)"
            [disabled]="loading()"
          >
            {{ loading() ? '...' : t().attending }}
          </button>
          <button
            class="btn btn-secondary"
            (click)="submitRSVP(false)"
            [disabled]="loading()"
          >
            {{ loading() ? '...' : t().notAvailable }}
          </button>
        </div>
      } @else {
        <div class="confirmation">
          <p>{{ t().thanks }} {{ userName() }} !</p>
          <button class="btn-link" (click)="resetForm()">
            {{ t().changeResponse }}
          </button>
        </div>
      }

      @if (attendingGuests.length > 0 || notAttendingGuests.length > 0) {
        <div class="divider"></div>
        <div class="guests">
          @if (attendingGuests.length > 0) {
            <div class="guest-col">
              <h3>{{ t().present }} <span>{{ attendingGuests.length }}</span></h3>
              <ul class="guest-list">
                @for (guest of attendingGuests; track guest.id) {
                  <li>{{ guest.name }}</li>
                }
              </ul>
            </div>
          }
          @if (notAttendingGuests.length > 0) {
            <div class="guest-col absent">
              <h3>{{ t().absent }} <span>{{ notAttendingGuests.length }}</span></h3>
              <ul class="guest-list">
                @for (guest of notAttendingGuests; track guest.id) {
                  <li>{{ guest.name }}</li>
                }
              </ul>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>
