<div class="page">
  <div class="container">
    <div class="card">
      <div class="user-bar">
        @if (user(); as currentUser) {
          <div class="user-info">
            @if (currentUser.picture) {
              <img [src]="currentUser.picture" alt="Photo de profil" class="user-avatar" referrerpolicy="no-referrer" />
            }
            <span class="user-name">{{ currentUser.name }}</span>
          </div>
          <button class="btn-logout" (click)="logout()">Deconnexion</button>
        }
      </div>

      <div class="header">
        <span class="badge">23 Mars 2025</span>
        <h1>Phileas</h1>
        <p>fete ses 8 ans !</p>
      </div>

      @if (error()) {
        <div class="error-message">
          {{ error() }}
        </div>
      }

      @if (showForm()) {
        <div class="form-group">
          <label>Tu reponds en tant que</label>
          <div class="user-display">{{ userName() }}</div>
        </div>
        <div class="btn-group">
          <button
            class="btn btn-primary"
            (click)="submitRSVP(true)"
            [disabled]="loading()"
          >
            {{ loading() ? '...' : 'Je viens !' }}
          </button>
          <button
            class="btn btn-secondary"
            (click)="submitRSVP(false)"
            [disabled]="loading()"
          >
            {{ loading() ? '...' : 'Pas dispo' }}
          </button>
        </div>
      } @else {
        <div class="confirmation">
          <p>Merci {{ userName() }} !</p>
          <button class="btn-link" (click)="resetForm()">
            Modifier ma reponse
          </button>
        </div>
      }

      @if (attendingGuests.length > 0 || notAttendingGuests.length > 0) {
        <div class="divider"></div>
        <div class="guests">
          @if (attendingGuests.length > 0) {
            <div class="guest-col">
              <h3>Presents <span>{{ attendingGuests.length }}</span></h3>
              <ul class="guest-list">
                @for (guest of attendingGuests; track guest.id) {
                  <li>{{ guest.name }}</li>
                }
              </ul>
            </div>
          }
          @if (notAttendingGuests.length > 0) {
            <div class="guest-col absent">
              <h3>Absents <span>{{ notAttendingGuests.length }}</span></h3>
              <ul class="guest-list">
                @for (guest of notAttendingGuests; track guest.id) {
                  <li>{{ guest.name }}</li>
                }
              </ul>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>
